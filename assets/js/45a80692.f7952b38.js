"use strict";(self.webpackChunkzustand_zh=self.webpackChunkzustand_zh||[]).push([[870],{7726:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>a,contentTitle:()=>c,default:()=>l,frontMatter:()=>s,metadata:()=>i,toc:()=>u});var n=t(4848),o=t(8453);const s={title:"\u4ecezustand/context\u4e2d\u521b\u5efa\u4e0a\u4e0b\u6587",nav:18},c=void 0,i={id:"previous-versions/zustand-v3-create-context",title:"\u4ecezustand/context\u4e2d\u521b\u5efa\u4e0a\u4e0b\u6587",description:"\u81eav3.5\u8d77\uff0c\u63d0\u4f9b\u4e86\u7279\u6b8a\u7684 createContext\uff0c",source:"@site/docs/previous-versions/zustand-v3-create-context.md",sourceDirName:"previous-versions",slug:"/previous-versions/zustand-v3-create-context",permalink:"/zustand-zh/docs/previous-versions/zustand-v3-create-context",draft:!1,unlisted:!1,editUrl:"https://github.com/ouweiya/zustand-zh/blob/master/docs/previous-versions/zustand-v3-create-context.md",tags:[],version:"current",frontMatter:{title:"\u4ecezustand/context\u4e2d\u521b\u5efa\u4e0a\u4e0b\u6587",nav:18},sidebar:"tutorialSidebar",previous:{title:"\u6301\u4e45\u5316\u5b58\u50a8\u6570\u636e",permalink:"/zustand-zh/docs/integrations/persisting-store-data"},next:{title:"\u8fc1\u79fb\u5230v4",permalink:"/zustand-zh/docs/migrations/migrating-to-v4"}},a={},u=[{value:"\u5728\u771f\u5b9e\u7ec4\u4ef6\u4e2d\u4f7f\u7528 createContext",id:"createcontext-usage-in-real-components",level:2},{value:"\u4f7f\u7528\u6765\u81ea props \u7684\u521d\u59cb\u5316\u7684 createContext \u4f7f\u7528",id:"createcontext-usage-with-initialization-from-props",level:2},{value:"\u8fc1\u79fb",id:"migration",level:2}];function d(e){const r={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(r.p,{children:["\u81eav3.5\u8d77\uff0c\u63d0\u4f9b\u4e86\u7279\u6b8a\u7684 ",(0,n.jsx)(r.code,{children:"createContext"}),"\uff0c\r\n\u8fd9\u907f\u514d\u4e86\u8bef\u7528\u5b58\u50a8\u94a9\u5b50\u3002"]}),"\n",(0,n.jsxs)(r.blockquote,{children:["\n",(0,n.jsxs)(r.p,{children:[(0,n.jsx)(r.strong,{children:"\u6ce8\u610f"}),"\uff1a\u6b64\u51fd\u6570\u5728v4\u4e2d\u5df2\u88ab\u5f03\u7528\uff0c\u5e76\u5c06\u5728v5\u4e2d\u88ab\u79fb\u9664\u3002\u53c2\u89c1",(0,n.jsx)(r.a,{href:"#migration",children:"\u8fc1\u79fb"}),"\u3002"]}),"\n"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-jsx",children:"import create from 'zustand'\r\nimport createContext from 'zustand/context'\r\n\r\nconst { Provider, useStore } = createContext()\r\n\r\nconst createStore = () => create(...)\r\n\r\nconst App = () => (\r\n    <Provider createStore={createStore}>\r\n        ...\r\n    </Provider>\r\n)\r\n\r\nconst Component = () => {\r\n    const state = useStore()\r\n    const slice = useStore(selector)\r\n    ...\r\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"createcontext-usage-in-real-components",children:"\u5728\u771f\u5b9e\u7ec4\u4ef6\u4e2d\u4f7f\u7528 createContext"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-jsx",children:'import create from "zustand";\r\nimport createContext from "zustand/context";\r\n\r\n// \u6700\u4f73\u5b9e\u8df5\uff1a\u4f60\u53ef\u4ee5\u5c06\u4e0b\u9762\u7684 createContext() \u548c createStore \u79fb\u5230\u4e00\u4e2a\u5355\u72ec\u7684\u6587\u4ef6(store.js)\u4e2d\uff0c\u5e76\u5728\u8fd9\u91cc/\u4f60\u9700\u8981\u7684\u5730\u65b9\u5bfc\u5165 Provider\uff0cuseStore\u3002\r\n\r\nconst { Provider, useStore } = createContext();\r\n\r\nconst createStore = () =>\r\n    create((set) => ({\r\n        bears: 0,\r\n        increasePopulation: () => set((state) => ({ bears: state.bears + 1 })),\r\n        removeAllBears: () => set({ bears: 0 })\r\n    }));\r\n\r\nconst Button = () => {\r\n    return (\r\n            {/** store() - \u8fd9\u5c06\u4e3a\u6bcf\u6b21\u4f7f\u7528 Button \u7ec4\u4ef6\u521b\u5efa\u4e00\u4e2a\u5b58\u50a8\uff0c\u800c\u4e0d\u662f\u4e3a\u6240\u6709\u7ec4\u4ef6\u4f7f\u7528\u4e00\u4e2a\u5b58\u50a8 **/}\r\n        <Provider createStore={createStore}>\r\n            <ButtonChild />\r\n        </Provider>\r\n    );\r\n};\r\n\r\nconst ButtonChild = () => {\r\n    const state = useStore();\r\n    return (\r\n        <div>\r\n            {state.bears}\r\n            <button\r\n                onClick={() => {\r\n                    state.increasePopulation();\r\n                }}\r\n            >\r\n                +\r\n            </button>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default function App() {\r\n    return (\r\n        <div className="App">\r\n            <Button />\r\n            <Button />\r\n        </div>\r\n    );\r\n}\n'})}),"\n",(0,n.jsx)(r.h2,{id:"createcontext-usage-with-initialization-from-props",children:"\u4f7f\u7528\u6765\u81ea props \u7684\u521d\u59cb\u5316\u7684 createContext \u4f7f\u7528"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-tsx",children:"import create from 'zustand'\r\nimport createContext from 'zustand/context'\r\n\r\nconst { Provider, useStore } = createContext()\r\n\r\nexport default function App({ initialBears }) {\r\n    return (\r\n        <Provider\r\n            createStore={() =>\r\n                create((set) => ({\r\n                    bears: initialBears,\r\n                    increase: () => set((state) => ({ bears: state.bears + 1 })),\r\n                }))\r\n            }\r\n        >\r\n            <Button />\r\n        </Provider>\r\n    )\r\n}\n"})}),"\n",(0,n.jsx)(r.h2,{id:"migration",children:"\u8fc1\u79fb"}),"\n",(0,n.jsxs)(r.p,{children:["\u8ba8\u8bba\uff1a",(0,n.jsx)(r.a,{href:"https://github.com/pmndrs/zustand/discussions/1276",children:"https://github.com/pmndrs/zustand/discussions/1276"})]}),"\n",(0,n.jsx)(r.p,{children:"\u8fd9\u662f\u4f7f\u7528v4 API\u7684\u65b0\u4e0a\u4e0b\u6587\u4f7f\u7528\u65b9\u6cd5\u3002"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-jsx",children:"import { createContext, useContext, useRef } from 'react'\r\nimport { createStore, useStore } from 'zustand'\r\n\r\nconst StoreContext = createContext(null)\r\n\r\nconst StoreProvider = ({ children }) => {\r\n    const storeRef = useRef()\r\n    if (!storeRef.current) {\r\n        storeRef.current = createStore((set) => ({\r\n            // ...\r\n        }))\r\n    }\r\n    return (\r\n        <StoreContext.Provider value={storeRef.current}>\r\n            {children}\r\n        </StoreContext.Provider>\r\n    )\r\n}\r\n\r\nconst useStoreInContext = (selector) => {\r\n    const store = useContext(StoreContext)\r\n    if (!store) {\r\n        throw new Error('Missing StoreProvider')\r\n    }\r\n    return useStore(store, selector)\r\n}\n"})}),"\n",(0,n.jsx)(r.p,{children:"\u6216\u8005\u4f7f\u7528\u4e00\u4e9b\u63d0\u4f9b Zustand v3-like APIs \u7684\u7b2c\u4e09\u65b9\u5e93\uff1a"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"https://github.com/charkour/zustand-di",children:"https://github.com/charkour/zustand-di"})}),"\n",(0,n.jsx)(r.li,{children:(0,n.jsx)(r.a,{href:"https://github.com/arvinxx/zustand-utils",children:"https://github.com/arvinxx/zustand-utils"})}),"\n"]})]})}function l(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,r,t)=>{t.d(r,{R:()=>c,x:()=>i});var n=t(6540);const o={},s=n.createContext(o);function c(e){const r=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),n.createElement(s.Provider,{value:r},e.children)}}}]);