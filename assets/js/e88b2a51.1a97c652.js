"use strict";(self.webpackChunkzustand_zh=self.webpackChunkzustand_zh||[]).push([[8095],{3927:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"guides/how-to-reset-state","title":"\u5982\u4f55\u91cd\u7f6e\u72b6\u6001","description":"\u4ee5\u4e0b\u6a21\u5f0f\u53ef\u7528\u4e8e\u5c06\u72b6\u6001\u91cd\u7f6e\u4e3a\u5176\u521d\u59cb\u503c\u3002","source":"@site/docs/guides/how-to-reset-state.md","sourceDirName":"guides","slug":"/guides/how-to-reset-state","permalink":"/zustand-zh/docs/guides/how-to-reset-state","draft":false,"unlisted":false,"editUrl":"https://github.com/ouweiya/zustand-zh/blob/master/docs/guides/how-to-reset-state.md","tags":[],"version":"current","frontMatter":{"title":"\u5982\u4f55\u91cd\u7f6e\u72b6\u6001","nav":13},"sidebar":"tutorialSidebar","previous":{"title":"\u5c06URL\u8fde\u63a5\u5230\u72b6\u6001","permalink":"/zustand-zh/docs/guides/connect-to-state-with-url-hash"},"next":{"title":"\u4f7f\u7528 props \u521d\u59cb\u5316\u72b6\u6001","permalink":"/zustand-zh/docs/guides/initialize-state-with-props"}}');var s=n(4848),a=n(8453);const o={title:"\u5982\u4f55\u91cd\u7f6e\u72b6\u6001",nav:13},i=void 0,d={},c=[{value:"CodeSandbox \u6f14\u793a",id:"codesandbox-demo",level:2}];function l(e){const t={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"\u4ee5\u4e0b\u6a21\u5f0f\u53ef\u7528\u4e8e\u5c06\u72b6\u6001\u91cd\u7f6e\u4e3a\u5176\u521d\u59cb\u503c\u3002"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"import { create } from 'zustand'\r\n\r\n// \u5206\u522b\u4e3a\u72b6\u6001\u503c\u548c\u64cd\u4f5c\u5b9a\u4e49\u7c7b\u578b\r\ntype State = {\r\n    salmon: number\r\n    tuna: number\r\n}\r\n\r\ntype Actions = {\r\n    addSalmon: (qty: number) => void\r\n    addTuna: (qty: number) => void\r\n    reset: () => void\r\n}\r\n\r\n// \u5b9a\u4e49\u521d\u59cb\u72b6\u6001\r\nconst initialState: State = {\r\n    salmon: 0,\r\n    tuna: 0,\r\n}\r\n\r\n// \u521b\u5efa\u5b58\u50a8\r\nconst useSlice = create<State & Actions>()((set, get) => ({\r\n    ...initialState,\r\n    addSalmon: (qty: number) => {\r\n        set({ salmon: get().salmon + qty })\r\n    },\r\n    addTuna: (qty: number) => {\r\n        set({ tuna: get().tuna + qty })\r\n    },\r\n    reset: () => {\r\n        set(initialState)\r\n    },\r\n}))\n"})}),"\n",(0,s.jsx)(t.p,{children:"\u4e00\u6b21\u91cd\u7f6e\u591a\u4e2a\u5b58\u50a8"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"import { create as _create } from 'zustand'\r\nimport type { StateCreator } from 'zustand'\r\n\r\nconst storeResetFns = new Set<() => void>()\r\n\r\nconst resetAllStores = () => {\r\n    storeResetFns.forEach((resetFn) => {\r\n        resetFn()\r\n    })\r\n}\r\n\r\nexport const create = (<T extends unknown>() => {\r\n    return (stateCreator: StateCreator<T>) => {\r\n        const store = _create(stateCreator)\r\n        const initialState = store.getState()\r\n        storeResetFns.add(() => {\r\n            store.setState(initialState, true)\r\n        })\r\n        return store\r\n    }\r\n}) as typeof _create\n"})}),"\n",(0,s.jsx)(t.p,{children:"\u4f7f\u7528\u5207\u7247\u6a21\u5f0f\u91cd\u7f6e\u7ed1\u5b9a\u7684\u5b58\u50a8"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-ts",children:"import create from 'zustand'\r\nimport type { StateCreator } from 'zustand'\r\n\r\nconst sliceResetFns = new Set<() => void>()\r\n\r\nexport const resetAllSlices = () => {\r\n    sliceResetFns.forEach((resetFn) => {\r\n        resetFn()\r\n    })\r\n}\r\n\r\nconst initialBearState = { bears: 0 }\r\n\r\ninterface BearSlice {\r\n    bears: number\r\n    addBear: () => void\r\n    eatFish: () => void\r\n}\r\n\r\nconst createBearSlice: StateCreator<\r\n    BearSlice & FishSlice,\r\n    [],\r\n    [],\r\n    BearSlice\r\n> = (set) => {\r\n    sliceResetFns.add(() => set(initialBearState))\r\n    return {\r\n        ...initialBearState,\r\n        addBear: () => set((state) => ({ bears: state.bears + 1 })),\r\n        eatFish: () => set((state) => ({ fishes: state.fishes - 1 })),\r\n    }\r\n}\r\n\r\nconst initialStateFish = { fishes: 0 }\r\n\r\ninterface FishSlice {\r\n    fishes: number\r\n    addFish: () => void\r\n}\r\n\r\nconst createFishSlice: StateCreator<\r\n    BearSlice & FishSlice,\r\n    [],\r\n    [],\r\n    FishSlice\r\n> = (set) => {\r\n    sliceResetFns.add(() => set(initialStateFish))\r\n    return {\r\n        ...initialStateFish,\r\n        addFish: () => set((state) => ({ fishes: state.fishes + 1 })),\r\n    }\r\n}\r\n\r\nconst useBoundStore = create<BearSlice & FishSlice>()((...a) => ({\r\n    ...createBearSlice(...a),\r\n    ...createFishSlice(...a),\r\n}))\r\n\r\nexport default useBoundStore\n"})}),"\n",(0,s.jsx)(t.h2,{id:"codesandbox-demo",children:"CodeSandbox \u6f14\u793a"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\u57fa\u7840\uff1a",(0,s.jsx)(t.a,{href:"https://codesandbox.io/s/zustand-how-to-reset-state-basic-demo-rrqyon",children:"https://codesandbox.io/s/zustand-how-to-reset-state-basic-demo-rrqyon"})]}),"\n",(0,s.jsxs)(t.li,{children:["\u9ad8\u7ea7\uff1a",(0,s.jsx)(t.a,{href:"https://codesandbox.io/s/zustand-how-to-reset-state-advanced-demo-gtu0qe",children:"https://codesandbox.io/s/zustand-how-to-reset-state-advanced-demo-gtu0qe"})]}),"\n",(0,s.jsxs)(t.li,{children:["Immer\uff1a",(0,s.jsx)(t.a,{href:"https://codesandbox.io/s/how-to-reset-state-advance-immer-demo-nyet3f",children:"https://codesandbox.io/s/how-to-reset-state-advance-immer-demo-nyet3f"})]}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>i});var r=n(6540);const s={},a=r.createContext(s);function o(e){const t=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(a.Provider,{value:t},e.children)}}}]);