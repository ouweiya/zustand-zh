"use strict";(self.webpackChunkzustand_zh=self.webpackChunkzustand_zh||[]).push([[6407],{5355:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"guides/connect-to-state-with-url-hash","title":"\u5c06URL\u8fde\u63a5\u5230\u72b6\u6001","description":"\u5c06\u72b6\u6001\u4e0eURL\u54c8\u5e0c\u8fde\u63a5","source":"@site/docs/guides/connect-to-state-with-url-hash.md","sourceDirName":"guides","slug":"/guides/connect-to-state-with-url-hash","permalink":"/zustand-zh/docs/guides/connect-to-state-with-url-hash","draft":false,"unlisted":false,"editUrl":"https://github.com/ouweiya/zustand-zh/blob/master/docs/guides/connect-to-state-with-url-hash.md","tags":[],"version":"current","frontMatter":{"title":"\u5c06URL\u8fde\u63a5\u5230\u72b6\u6001","nav":12},"sidebar":"tutorialSidebar","previous":{"title":"Map \u548c Set \u7684\u4f7f\u7528","permalink":"/zustand-zh/docs/guides/maps-and-sets-usage"},"next":{"title":"\u5982\u4f55\u91cd\u7f6e\u72b6\u6001","permalink":"/zustand-zh/docs/guides/how-to-reset-state"}}');var t=n(4848),a=n(8453);const o={title:"\u5c06URL\u8fde\u63a5\u5230\u72b6\u6001",nav:12},i=void 0,c={},h=[{value:"\u5c06\u72b6\u6001\u4e0eURL\u54c8\u5e0c\u8fde\u63a5",id:"connect-state-with-url-hash",level:2},{value:"CodeSandbox \u6f14\u793a",id:"codesandbox-demo",level:3},{value:"\u6301\u4e45\u5316\u5e76\u5c06\u72b6\u6001\u4e0eURL\u53c2\u6570\u8fde\u63a5\uff08\u793a\u4f8b\uff1aURL\u67e5\u8be2\u53c2\u6570\uff09",id:"persist-and-connect-state-with-url-parameters-(example:-url-query-parameters)",level:2}];function l(e){const r={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.h2,{id:"connect-state-with-url-hash",children:"\u5c06\u72b6\u6001\u4e0eURL\u54c8\u5e0c\u8fde\u63a5"}),"\n",(0,t.jsx)(r.p,{children:"\u5982\u679c\u4f60\u60f3\u5c06\u5b58\u50a8\u7684\u72b6\u6001\u4e0eURL\u54c8\u5e0c\u8fde\u63a5\uff0c\u4f60\u53ef\u4ee5\u521b\u5efa\u81ea\u5df1\u7684\u54c8\u5e0c\u5b58\u50a8\u3002"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"import { create } from 'zustand'\r\nimport { persist, StateStorage, createJSONStorage } from 'zustand/middleware'\r\n\r\nconst hashStorage: StateStorage = {\r\n    getItem: (key): string => {\r\n        const searchParams = new URLSearchParams(location.hash.slice(1))\r\n        const storedValue = searchParams.get(key) ?? ''\r\n        return JSON.parse(storedValue)\r\n    },\r\n    setItem: (key, newValue): void => {\r\n        const searchParams = new URLSearchParams(location.hash.slice(1))\r\n        searchParams.set(key, JSON.stringify(newValue))\r\n        location.hash = searchParams.toString()\r\n    },\r\n    removeItem: (key): void => {\r\n        const searchParams = new URLSearchParams(location.hash.slice(1))\r\n        searchParams.delete(key)\r\n        location.hash = searchParams.toString()\r\n    },\r\n}\r\n\r\nexport const useBoundStore = create(\r\n    persist(\r\n        (set, get) => ({\r\n            fishes: 0,\r\n            addAFish: () => set({ fishes: get().fishes + 1 }),\r\n        }),\r\n        {\r\n            name: 'food-storage', // \u552f\u4e00\u540d\u79f0\r\n            storage: createJSONStorage(() => hashStorage),\r\n        },\r\n    ),\r\n)\n"})}),"\n",(0,t.jsx)(r.h3,{id:"codesandbox-demo",children:"CodeSandbox \u6f14\u793a"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.a,{href:"https://codesandbox.io/s/zustand-state-with-url-hash-demo-f29b88?file=/src/store/index.ts",children:"https://codesandbox.io/s/zustand-state-with-url-hash-demo-f29b88?file=/src/store/index.ts"})}),"\n",(0,t.jsx)(r.h2,{id:"persist-and-connect-state-with-url-parameters-(example:-url-query-parameters)",children:"\u6301\u4e45\u5316\u5e76\u5c06\u72b6\u6001\u4e0eURL\u53c2\u6570\u8fde\u63a5\uff08\u793a\u4f8b\uff1aURL\u67e5\u8be2\u53c2\u6570\uff09"}),"\n",(0,t.jsxs)(r.p,{children:["\u6709\u65f6\u5019\uff0c\u4f60\u53ef\u80fd\u5e0c\u671b\u6761\u4ef6\u6027\u5730\u5c06\u72b6\u6001\u8fde\u63a5\u5230URL\u3002\r\n\u6b64\u793a\u4f8b\u63cf\u8ff0\u4e86\u5982\u4f55\u4f7f\u7528URL\u67e5\u8be2\u53c2\u6570\uff0c\r\n\u540c\u65f6\u5c06\u5176\u4e0e\u53e6\u4e00\u79cd\u6301\u4e45\u5316\u5b9e\u73b0\uff08\u5982",(0,t.jsx)(r.code,{children:"localstorage"}),"\uff09\u4fdd\u6301\u540c\u6b65\u3002"]}),"\n",(0,t.jsxs)(r.p,{children:["\u5982\u679c\u4f60\u5e0c\u671bURL\u53c2\u6570\u59cb\u7ec8\u586b\u5145\uff0c\u53ef\u4ee5\u5220\u9664\u5bf9",(0,t.jsx)(r.code,{children:"getUrlSearch()"}),"\u7684\u6761\u4ef6\u68c0\u67e5\u3002"]}),"\n",(0,t.jsx)(r.p,{children:"\u4e0b\u9762\u7684\u5b9e\u73b0\u5c06\u5728\u76f8\u5173\u72b6\u6001\u66f4\u6539\u65f6\u66f4\u65b0URL\uff0c\u65e0\u9700\u5237\u65b0\u3002"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"import { create } from 'zustand'\r\nimport { persist, StateStorage, createJSONStorage } from 'zustand/middleware'\r\n\r\nconst getUrlSearch = () => {\r\n    return window.location.search.slice(1)\r\n}\r\n\r\nconst persistentStorage: StateStorage = {\r\n    getItem: (key): string => {\r\n        // \u5148\u68c0\u67e5URL\r\n        if (getUrlSearch()) {\r\n            const searchParams = new URLSearchParams(getUrlSearch())\r\n            const storedValue = searchParams.get(key)\r\n            return JSON.parse(storedValue as string)\r\n        } else {\r\n            // \u5426\u5219\uff0c\u6211\u4eec\u5e94\u8be5\u4ecelocalstorage\u6216\u5176\u4ed6\u5b58\u50a8\u4e2d\u52a0\u8f7d\r\n            return JSON.parse(localStorage.getItem(key) as string)\r\n        }\r\n    },\r\n    setItem: (key, newValue): void => {\r\n        // \u68c0\u67e5\u662f\u5426\u5b58\u5728\u67e5\u8be2\u53c2\u6570\uff0c\u5982\u679c\u59cb\u7ec8\u5e0c\u671b\u8bbe\u7f6eURL\uff0c\u53ef\u4ee5\u5220\u9664\u68c0\u67e5\r\n        if (getUrlSearch()) {\r\n            const searchParams = new URLSearchParams(getUrlSearch())\r\n            searchParams.set(key, JSON.stringify(newValue))\r\n            window.history.replaceState(null, '', `?${searchParams.toString()}`)\r\n        }\r\n\r\n        localStorage.setItem(key, JSON.stringify(newValue))\r\n    },\r\n    removeItem: (key): void => {\r\n        const searchParams = new URLSearchParams(getUrlSearch())\r\n        searchParams.delete(key)\r\n        window.location.search = searchParams.toString()\r\n    },\r\n}\r\n\r\ntype LocalAndUrlStore = {\r\n    typesOfFish: string[]\r\n    addTypeOfFish: (fishType: string) => void\r\n    numberOfBears: number\r\n    setNumberOfBears: (newNumber: number) => void\r\n}\r\n\r\nconst storageOptions = {\r\n    name: 'fishAndBearsStore',\r\n    storage: createJSONStorage<LocalAndUrlStore>(() => persistentStorage),\r\n}\r\n\r\nconst useLocalAndUrlStore = create(\r\n    persist<LocalAndUrlStore>(\r\n        (set) => ({\r\n            typesOfFish: [],\r\n            addTypeOfFish: (fishType) =>\r\n                set((state) => ({ typesOfFish: [...state.typesOfFish, fishType] })),\r\n\r\n            numberOfBears: 0,\r\n            setNumberOfBears: (numberOfBears) => set(() => ({ numberOfBears })),\r\n        }),\r\n        storageOptions,\r\n    ),\r\n)\r\n\r\nexport default useLocalAndUrlStore\n"})}),"\n",(0,t.jsx)(r.p,{children:"\u5728\u4ece\u7ec4\u4ef6\u751f\u6210URL\u65f6\uff0c\u4f60\u53ef\u4ee5\u8c03\u7528buildShareableUrl\uff1a"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-ts",children:"const buildURLSuffix = (params, version = 0) => {\r\n    const searchParams = new URLSearchParams()\r\n\r\n    const zustandStoreParams = {\r\n        state: {\r\n            typesOfFish: params.typesOfFish,\r\n            numberOfBears: params.numberOfBears,\r\n        },\r\n        version: version, // \u7248\u672c\u5728\u8fd9\u91cc\u662f\u56e0\u4e3a\u5b83\u5305\u542b\u5728Zustand\u8bbe\u7f6e\u72b6\u6001\u7684\u65b9\u5f0f\u4e2d\r\n    }\r\n\r\n    // URL\u53c2\u6570\u952e\u5e94\u4e0e\u5b58\u50a8\u7684\u540d\u79f0\u5339\u914d\uff0c\u5982\u4e0a\u9762\u7684storageOptions\u4e2d\u6307\u5b9a\u7684\r\n    searchParams.set('fishAndBearsStore', JSON.stringify(zustandStoreParams))\r\n    return searchParams.toString()\r\n}\r\n\r\nexport const buildShareableUrl = (params, version) => {\r\n    return `${window.location.origin}?${buildURLSuffix(params, version)}`\r\n}\n"})}),"\n",(0,t.jsx)(r.p,{children:"\u751f\u6210\u7684URL\u770b\u8d77\u6765\u50cf\u8fd9\u6837\uff08\u8fd9\u91cc\u6ca1\u6709\u4efb\u4f55\u7f16\u7801\uff0c\u4e3a\u4e86\u6613\u8bfb\uff09\uff1a"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.code,{children:'https://localhost/search?fishAndBearsStore={"state":{"typesOfFish":["tilapia","salmon"],"numberOfBears":15},"version":0}}'})})]})}function d(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>o,x:()=>i});var s=n(6540);const t={},a=s.createContext(t);function o(e){const r=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(a.Provider,{value:r},e.children)}}}]);