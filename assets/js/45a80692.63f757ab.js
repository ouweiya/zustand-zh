"use strict";(self.webpackChunkzustand_zh=self.webpackChunkzustand_zh||[]).push([[870],{7726:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>l,frontMatter:()=>s,metadata:()=>a,toc:()=>u});var n=r(4848),o=r(8453);const s={title:"createContext from zustand/context",nav:18},i=void 0,a={id:"previous-versions/zustand-v3-create-context",title:"createContext from zustand/context",description:"A special createContext is provided since v3.5,",source:"@site/docs/previous-versions/zustand-v3-create-context.md",sourceDirName:"previous-versions",slug:"/previous-versions/zustand-v3-create-context",permalink:"/zustand-zh/docs/previous-versions/zustand-v3-create-context",draft:!1,unlisted:!1,editUrl:"https://github.com/ouweiya/zustand-zh/docs/previous-versions/zustand-v3-create-context.md",tags:[],version:"current",frontMatter:{title:"createContext from zustand/context",nav:18},sidebar:"tutorialSidebar",previous:{title:"Migrating to v4",permalink:"/zustand-zh/docs/migrations/migrating-to-v4"}},c={},u=[{value:"createContext usage in real components",id:"createcontext-usage-in-real-components",level:2},{value:"createContext usage with initialization from props",id:"createcontext-usage-with-initialization-from-props",level:2},{value:"Migration",id:"migration",level:2}];function d(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(t.p,{children:["A special ",(0,n.jsx)(t.code,{children:"createContext"})," is provided since v3.5,\r\nwhich avoids misusing the store hook."]}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.strong,{children:"Note"}),": This function is deprecated in v4 and will be removed in v5. See ",(0,n.jsx)(t.a,{href:"#migration",children:"Migration"}),"."]}),"\n"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-jsx",children:"import create from 'zustand'\r\nimport createContext from 'zustand/context'\r\n\r\nconst { Provider, useStore } = createContext()\r\n\r\nconst createStore = () => create(...)\r\n\r\nconst App = () => (\r\n  <Provider createStore={createStore}>\r\n    ...\r\n  </Provider>\r\n)\r\n\r\nconst Component = () => {\r\n  const state = useStore()\r\n  const slice = useStore(selector)\r\n  ...\r\n}\n"})}),"\n",(0,n.jsx)(t.h2,{id:"createcontext-usage-in-real-components",children:"createContext usage in real components"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-jsx",children:'import create from "zustand";\r\nimport createContext from "zustand/context";\r\n\r\n// Best practice: You can move the below createContext() and createStore to a separate file(store.js) and import the Provider, useStore here/wherever you need.\r\n\r\nconst { Provider, useStore } = createContext();\r\n\r\nconst createStore = () =>\r\n  create((set) => ({\r\n    bears: 0,\r\n    increasePopulation: () => set((state) => ({ bears: state.bears + 1 })),\r\n    removeAllBears: () => set({ bears: 0 })\r\n  }));\r\n\r\nconst Button = () => {\r\n  return (\r\n      {/** store() - This will create a store for each time using the Button component instead of using one store for all components **/}\r\n    <Provider createStore={createStore}>\r\n      <ButtonChild />\r\n    </Provider>\r\n  );\r\n};\r\n\r\nconst ButtonChild = () => {\r\n  const state = useStore();\r\n  return (\r\n    <div>\r\n      {state.bears}\r\n      <button\r\n        onClick={() => {\r\n          state.increasePopulation();\r\n        }}\r\n      >\r\n        +\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default function App() {\r\n  return (\r\n    <div className="App">\r\n      <Button />\r\n      <Button />\r\n    </div>\r\n  );\r\n}\n'})}),"\n",(0,n.jsx)(t.h2,{id:"createcontext-usage-with-initialization-from-props",children:"createContext usage with initialization from props"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-tsx",children:"import create from 'zustand'\r\nimport createContext from 'zustand/context'\r\n\r\nconst { Provider, useStore } = createContext()\r\n\r\nexport default function App({ initialBears }) {\r\n  return (\r\n    <Provider\r\n      createStore={() =>\r\n        create((set) => ({\r\n          bears: initialBears,\r\n          increase: () => set((state) => ({ bears: state.bears + 1 })),\r\n        }))\r\n      }\r\n    >\r\n      <Button />\r\n    </Provider>\r\n  )\r\n}\n"})}),"\n",(0,n.jsx)(t.h2,{id:"migration",children:"Migration"}),"\n",(0,n.jsxs)(t.p,{children:["Discussion: ",(0,n.jsx)(t.a,{href:"https://github.com/pmndrs/zustand/discussions/1276",children:"https://github.com/pmndrs/zustand/discussions/1276"})]}),"\n",(0,n.jsx)(t.p,{children:"Here's the new context usage with v4 API."}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-jsx",children:"import { createContext, useContext, useRef } from 'react'\r\nimport { createStore, useStore } from 'zustand'\r\n\r\nconst StoreContext = createContext(null)\r\n\r\nconst StoreProvider = ({ children }) => {\r\n  const storeRef = useRef()\r\n  if (!storeRef.current) {\r\n    storeRef.current = createStore((set) => ({\r\n      // ...\r\n    }))\r\n  }\r\n  return (\r\n    <StoreContext.Provider value={storeRef.current}>\r\n      {children}\r\n    </StoreContext.Provider>\r\n  )\r\n}\r\n\r\nconst useStoreInContext = (selector) => {\r\n  const store = useContext(StoreContext)\r\n  if (!store) {\r\n    throw new Error('Missing StoreProvider')\r\n  }\r\n  return useStore(store, selector)\r\n}\n"})}),"\n",(0,n.jsx)(t.p,{children:"Or reach out to some third-party libraries that provide Zustand v3-like APIs:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/charkour/zustand-di",children:"https://github.com/charkour/zustand-di"})}),"\n",(0,n.jsx)(t.li,{children:(0,n.jsx)(t.a,{href:"https://github.com/arvinxx/zustand-utils",children:"https://github.com/arvinxx/zustand-utils"})}),"\n"]})]})}function l(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,t,r)=>{r.d(t,{R:()=>i,x:()=>a});var n=r(6540);const o={},s=n.createContext(o);function i(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);